#!/usr/bin/env bash
set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
AFS_ROOT="${AFS_ROOT:-$(cd "${SCRIPT_DIR}/.." && pwd)}"
AFS_CLI="${AFS_CLI:-$AFS_ROOT/scripts/afs}"
VENV_DIR="${AFS_VENV:-${AFS_ROOT}/.venv}"

if [ -x "$AFS_CLI" ]; then
  exec "$AFS_CLI" agents run context-warm -- "$@"
fi

if [ -x "${VENV_DIR}/bin/python" ]; then
  PYTHON_BIN="${VENV_DIR}/bin/python"
else
  PYTHON_BIN="python3"
fi

if ! command -v "$PYTHON_BIN" >/dev/null 2>&1; then
  echo "python not found: ${PYTHON_BIN}" >&2
  exit 1
fi

PYTHONPATH="$AFS_ROOT/src" exec "$PYTHON_BIN" -m afs.agents.context_warm "$@"
